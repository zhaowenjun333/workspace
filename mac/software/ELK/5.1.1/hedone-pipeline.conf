# The # character at the beginning of a line indicates a comment. Use
# comments to describe your configuration.
input {
   beats {
        port => "5043"
   }
}

# The filter part of this file is commented out to indicate that it is
# optional.
filter {
    urldecode {
      all_fields => true
    }
    json{
        source => "message"
    }
    if "/rest/live/cast/heartbeat/" in [url] or "/" == [url] or ".js" in [url] or ".jpg" in [url] or ".css" in [url] or ".png" in [url]{
      drop{
      }
    }else{
    if "/rest/user/" in [url]  or "/rest/school/" in [url] or "/rest/ugcengin/" in [url] or "/rest/search/" in [url] or "/rest/classsquare/" in [url] or "/rest/system/" in [url] or "/rest/wwshow/" in [url] or "/rest/order/" in [url] or "/rest/topic/" in [url] or "/rest/live/" in [url] or "/rest/question/" in [url] or "/rest/message/" in [url]{
    grok {
         match => { "request" =>"%{WORD:method} %{URIPATHPARAM:uripathparam}"}
    }
    if "sessionKey" in [uripathparam]{
     kv{
        source => "uripathparam"
        field_split => "?&"
     }
    }
    geoip {
        source => "clientip"
    }
    if "/rest/user/" in [url]  {
          add_field => {"component"=>"hedone-user"}
    } 
    if "/rest/school/" in [url] {
          add_field => {"component"=>"hedone-school"}
    } 
    if "/rest/ugcengin/" in [url] {
          add_field => {"component"=>"hedone-ugcengin"}
    } 
    if "/rest/search/" in [url] {
          add_field => {"component"=>"hedone-search"}
    }
    if "/rest/classsquare/" in [url] {
          add_field => {"component"=>"hedone-classsquare"}
    } 
    if "/rest/system/" in [url] {
          add_field => {"component"=>"hedone-system"}
    } 
    if "/rest/wwshow/" in [url] {
          add_field => {"component"=>"hedone-wwshow"}
    } 
    if "/rest/order/" in [url] {
          add_field => {"component"=>"hedone-order"}
    } 
    if "/rest/topic/" in [url] {
          add_field => {"component"=>"hedone-topic"}
    }
    if "/rest/live/" in [url] {
          add_field => {"component"=>"hedone-live"}
    }
    if "/rest/question/" in [url] {
          add_field => {"component"=>"hedone-question"}
    } 
    if "/rest/message/" in [url]{
          add_field => {"component"=>"hedone-message"}
    }
    }else{
        drop{
        }
    }
   }
}
#output {
# stdout { codec => rubydebug }
#}

output {

    elasticsearch {
        hosts => [ "10.173.35.136:9200" ]
        if "/rest/user/" in [url]  {
          index => "hedone-user"
          template_name => "hedone-user"
        } else {
          index => "hedone-log"
           template_name => "hedone-log"
        }
        user => elastic
        password => wawa2016
    }

    if "/rest/user/" in [url]  {
      elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-user"
        template_name => "hedone-user"
        user => elastic
        password => wawa2016
       }
    } 
    else if "/rest/school/" in [url] {
     elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-school"
        template_name => "hedone-school"
        user => elastic
        password => wawa2016
       }
    } 
    else if "/rest/ugcengin/" in [url] {
      elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-ugcengin"
        template_name => "hedone-ugcengin"
        user => elastic
        password => wawa2016
       }
    } 
    else if "/rest/search/" in [url] {
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-search"
        template_name => "hedone-search"
        user => elastic
        password => wawa2016
       }
    }
    else if "/rest/classsquare/" in [url] {
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-classsquare"
        template_name => "hedone-classsquare"
        user => elastic
        password => wawa2016
       }
    } 
    if "/rest/system/" in [url] {
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-system"
        template_name => "hedone-system"
        user => elastic
        password => wawa2016
       }
    } 
    else if "/rest/wwshow/" in [url] {
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-wwshow"
        template_name => "hedone-wwshow"
        user => elastic
        password => wawa2016
       }
    } 
    else if "/rest/order/" in [url] {
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-order"
        template_name => "hedone-order"
        user => elastic
        password => wawa2016
       }
    } 
    if "/rest/topic/" in [url] {
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-topic"
        template_name => "hedone-topic"
        user => elastic
        password => wawa2016
       }
    }
    else if "/rest/live/" in [url] {
      elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-live"
        template_name => "hedone-live"
        user => elastic
        password => wawa2016
       }
    }
    else if "/rest/question/" in [url] {
           elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-question"
        template_name => "hedone-question"
        user => elastic
        password => wawa2016
       }
    } 
    else if "/rest/message/" in [url]{
       elasticsearch {
        hosts => [ "10.173.35.136:9201" ]
        index => "hedone-message"
        template_name => "hedone-message"
        user => elastic
        password => wawa2016
       }
    }else{
    
    }

}


